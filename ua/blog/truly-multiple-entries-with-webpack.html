<!DOCTYPE html><html lang="ua"><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>Truly Multiple Entries with Webpack | Технічні статті | Ігор Кузьменко</title><meta name="robots" content="index,follow"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:creator" content="@kuzzmi"/><meta property="og:title" content="Truly Multiple Entries with Webpack"/><meta property="og:description" content="In this post, I will try to explain how to handle situations when you need to use Webpack with a lot of small apps that share one codebase.
"/><meta property="og:url" content="https://kuzzmi.com/ua/blog/truly-multiple-entries-with-webpack"/><meta property="og:type" content="article"/><meta property="article:published_time" content="2016-06-29 15:16:15 +0200"/><meta property="article:author" content="https://kuzzmi.com"/><meta property="article:tag" content="technology"/><meta property="article:tag" content="react"/><meta property="article:tag" content="javascript"/><meta property="article:tag" content="web development"/><meta property="article:tag" content="webpack"/><meta property="article:tag" content="tips"/><link rel="canonical" href="https://kuzzmi.com/ua/blog/truly-multiple-entries-with-webpack"/><meta name="next-head-count" content="19"/><link rel="dns-prefetch" href="https://www.googleapis.com"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"/><link rel="apple-touch-icon" sizes="180x180" href="/static/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/static/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/static/favicon-16x16.png"/><link rel="manifest" href="/static/site.webmanifest"/><link rel="shortcut icon" href="/static/favicon.ico" type="image/x-icon"/><meta name="apple-mobile-web-app-capable" content="yes"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.5.0/styles/base16/railscasts.min.css"/><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.5.0/highlight.min.js"></script><meta name="author" content="Igor Kuzmenko"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin /><link rel="preload" href="/_next/static/css/8d3077ef275150e2.css" as="style"/><link rel="stylesheet" href="/_next/static/css/8d3077ef275150e2.css" data-n-g=""/><link rel="preload" href="/_next/static/css/5efee9f793991289.css" as="style"/><link rel="stylesheet" href="/_next/static/css/5efee9f793991289.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-69bfa6990bb9e155.js" defer=""></script><script src="/_next/static/chunks/framework-fc97f3f1282ce3ed.js" defer=""></script><script src="/_next/static/chunks/main-551bef8982a15171.js" defer=""></script><script src="/_next/static/chunks/pages/_app-84072d5e9d49e694.js" defer=""></script><script src="/_next/static/chunks/47-1461360545d2f08c.js" defer=""></script><script src="/_next/static/chunks/962-41b19898a46b0b4f.js" defer=""></script><script src="/_next/static/chunks/pages/%5Blocale%5D/blog/%5Bslug%5D-cde7d66f922c46b8.js" defer=""></script><script src="/_next/static/soa2Ej8tkNavLJb66JiCo/_buildManifest.js" defer=""></script><script src="/_next/static/soa2Ej8tkNavLJb66JiCo/_ssgManifest.js" defer=""></script><script src="/_next/static/soa2Ej8tkNavLJb66JiCo/_middlewareManifest.js" defer=""></script><style data-href="https://fonts.googleapis.com/css2?family=JetBrains+Mono&family=PT+Sans:ital,wght@0,400;0,700;1,400&display=swap">@font-face{font-family:'JetBrains Mono';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/jetbrainsmono/v11/tDbY2o-flEEny0FZhsfKu5WU4zr3E_BX0PnT8RD8yKxjPg.woff) format('woff')}@font-face{font-family:'PT Sans';font-style:italic;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/ptsans/v16/jizYRExUiTo99u79D0eEww.woff) format('woff')}@font-face{font-family:'PT Sans';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/ptsans/v16/jizaRExUiTo99u79P0Y.woff) format('woff')}@font-face{font-family:'PT Sans';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/ptsans/v16/jizfRExUiTo99u79B_mh4Oo.woff) format('woff')}@font-face{font-family:'JetBrains Mono';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/jetbrainsmono/v11/tDbY2o-flEEny0FZhsfKu5WU4zr3E_BX0PnT8RD8yKxTN1OTk6OThhvAWV8.woff) format('woff');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'JetBrains Mono';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/jetbrainsmono/v11/tDbY2o-flEEny0FZhsfKu5WU4zr3E_BX0PnT8RD8yKxTPlOTk6OThhvAWV8.woff) format('woff');unicode-range:U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'JetBrains Mono';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/jetbrainsmono/v11/tDbY2o-flEEny0FZhsfKu5WU4zr3E_BX0PnT8RD8yKxTOVOTk6OThhvAWV8.woff) format('woff');unicode-range:U+0370-03FF}@font-face{font-family:'JetBrains Mono';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/jetbrainsmono/v11/tDbY2o-flEEny0FZhsfKu5WU4zr3E_BX0PnT8RD8yKxTNVOTk6OThhvAWV8.woff) format('woff');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:'JetBrains Mono';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/jetbrainsmono/v11/tDbY2o-flEEny0FZhsfKu5WU4zr3E_BX0PnT8RD8yKxTNFOTk6OThhvAWV8.woff) format('woff');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'JetBrains Mono';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/jetbrainsmono/v11/tDbY2o-flEEny0FZhsfKu5WU4zr3E_BX0PnT8RD8yKxTOlOTk6OThhvA.woff) format('woff');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'PT Sans';font-style:italic;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/ptsans/v16/jizYRExUiTo99u79D0e0ysmIAjcQ-woy.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'PT Sans';font-style:italic;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/ptsans/v16/jizYRExUiTo99u79D0e0w8mIAjcQ-woy.woff2) format('woff2');unicode-range:U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'PT Sans';font-style:italic;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/ptsans/v16/jizYRExUiTo99u79D0e0ycmIAjcQ-woy.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'PT Sans';font-style:italic;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/ptsans/v16/jizYRExUiTo99u79D0e0x8mIAjcQ-w.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'PT Sans';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/ptsans/v16/jizaRExUiTo99u79D0-ExcOPIDUg-g.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'PT Sans';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/ptsans/v16/jizaRExUiTo99u79D0aExcOPIDUg-g.woff2) format('woff2');unicode-range:U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'PT Sans';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/ptsans/v16/jizaRExUiTo99u79D0yExcOPIDUg-g.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'PT Sans';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/ptsans/v16/jizaRExUiTo99u79D0KExcOPIDU.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'PT Sans';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/ptsans/v16/jizfRExUiTo99u79B_mh0OOtLR8a8zILig.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'PT Sans';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/ptsans/v16/jizfRExUiTo99u79B_mh0OqtLR8a8zILig.woff2) format('woff2');unicode-range:U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'PT Sans';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/ptsans/v16/jizfRExUiTo99u79B_mh0OCtLR8a8zILig.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'PT Sans';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/ptsans/v16/jizfRExUiTo99u79B_mh0O6tLR8a8zI.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}</style></head><body><div id="__next"><main class="PageLayout_page_container__M8QGN "><menu class="PageLayout_menu_container__La6NU"><ul><li class="PageLayout_inactive__g2bTn"><a href="/ua">Головна</a></li><li><a href="/ua/blog">Технічні статті</a></li><li class="PageLayout_inactive__g2bTn"><a href="/ua/thoughts">Роздуми</a></li></ul></menu><section class="PageLayout_content_container__1IMZI"><header class="PageLayout_header_container__Y6dbq"><div><div class="PageLayout_menu_button__vWi4y"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24px" height="24px"><path fill="none" stroke="#000000" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M3 12L21 12M3 6L21 6M3 18L21 18"></path></svg></div><p class="PageLayout_name__xhUaP"></p></div><div class="PageLayout_lang_switcher___L3bH"><p class="PageLayout_version__2_iha">версія<!-- -->:<!-- --></p><div class="PageLayout_langs__z_SxD"><a class="PageLayout_active__UxQoO" href="/ua/blog/truly-multiple-entries-with-webpack">🇺🇦</a><a class="" href="/en/blog/truly-multiple-entries-with-webpack">🇬🇧</a></div></div></header><article class="PageLayout_content__6Pdc3"><div class="Post_container__jmeoa"><div class="Post_notAvailable__snvTZ">Цей контент доступний тільки англійською мовою.</div><h1>Truly Multiple Entries with Webpack</h1><p class="Post_date__B7bMG">29.06.2016, 16:16:15</p><div><p>In this post, I will try to explain how to handle situations when you need to use <a href="https://webpack.js.org/">Webpack</a> with a lot of small apps that share one codebase.</p>
<p>If you want to jump straight to the code, check out my <a href="https://github.com/kuzzmi/webpack-multiple-entries">repository</a> on GitHub.</p>
<p><strong>NOTE:</strong> Despite the fact that this happened to me already five times, I still consider this as a not typical case. Perhaps I was just <em>lucky</em>.</p>
<p>This is what we'll try to do:</p>
<p><img src="/uploads/b54e37034d7de6913a4830a9b3e75fc1" alt="" /></p>
<p><a href="/uploads/b54e37034d7de6913a4830a9b3e75fc1">Link to the image</a></p>
<h2 id="webpackisyourbro">Webpack is your bro</h2>
<p>After using <a href="http://gruntjs.com/">Grunt</a> and <a href="http://gulpjs.com/">Gulp</a> for building JavaScript apps for quite a while, I find them a little bit meh. If you ask me "why?" I won't be able to answer, though. Probably I don't have that good experience with them. Or I do…</p>
<p>I can talk a lot about how awesome Webpack is, but to do this I need a whole new post, so let's focus on it and its configuration.</p>
<p>Imagine that you have two main folders: <code>core</code> and <code>apps</code>; the <code>apps</code> folder contains 50 micro SAPs. To make things easier, we'll call them widgets. Each widget is grouped by domain, thus one more level of nesting.</p>
<p>The folder structure may look like this, but it can be completely different:</p>
<p>{% highlight text %}
{% raw %}
~ src/</p>
<ul>
<li>core/                          &lt; where all reusable things are
~ apps/                          &lt; microapps folder
~ weather/
  ~ temperature/
      index.html
      index.js                 &lt; entry point
      App.js
      App.scss
      ListComponent.js
      ListComponent.scss
      ListComponent.spec.js<ul>
<li>humidity/</li>
<li>sunrise/
~ news/</li>
<li>feed/</li>
<li>sport/
{% endraw %}
{% endhighlight %}</li></ul></li>
</ul>
<p>And that is what we want to get:
{% highlight text %}
{% raw %}
~ dist/
  ~ weather/
    ~ temperature/
        index.html
        bundle.js
        bundle.css
    + humidity/
    + sunrise/</p>
<ul>
<li>news/
vendor.js
vendor.css
core.js
core.css
{% endraw %}
{% endhighlight %}</li>
</ul>
<h2 id="bundlingbundle">Bundling bundle</h2>
<p>The very first thing we need for bundling is to get a list of entry points. You can find <em>some</em> documentation about multiple entry points in Webpack <a href="https://webpack.github.io/docs/multiple-entry-points.html">here</a>.</p>
<p>In our case entry points are these multiple <code>index.js</code> files, from which your application starts functioning. Webpack's multiple entry points object follows:</p>
<p>{% highlight text %}
{% raw %}
{
 entry: {
     %path<em>to</em>result<em>file</em>name%: %path<em>to</em>entry<em>point%,
        // or
     %path</em>to<em>result</em>file<em>name%: [ %path</em>to<em>entry</em>point<em>1%, %path</em>to<em>entry</em>point_2% ]
    }
}
{% endraw %}
{% endhighlight %}</p>
<p>Where <code>path_to_result_file_name</code> is a <em>path to the file</em> we want to get as a result of bundling and <code>path_to_entry_point</code> is a path to the file OR a module name which we want to bundle.</p>
<p>For example, assume we have the following configuration:</p>
<p>{% highlight javascript %}
{% raw %}
{
 …
    entry: {
     './one/cool/stuff/bundle.js': './src/another/nested/folder/index.js'
    },
    output: {
        path: path.join(__dirname, 'dist'),
        filename: '[name].js',
    },
    …
}
{% endraw %}
{% endhighlight %}</p>
<p>The result of the <code>webpack</code> will be:</p>
<p>{% highlight javascript %}
{% raw %}
./
~ dist
  ~ one
    ~ cool
      ~ stuff
          bundle.js          &lt; bundled index.js and App.js
~ src
  ~ another
    ~ nested
      ~ folder
          index.js
          App.js             &lt; this file is requested from index.js
webpack.config.js
{% endraw %}
{% endhighlight %}</p>
<p>If you have a wtf-face, that's fine.</p>
<p>In our case <code>[name]</code> was resolved as a <code>./one/cool/stuff/bundle.js</code>, the path relative to <code>path.join(__dirname, 'dist')</code>. So webpack has written a file to <code>path.join(__dirname, 'dist') + './one/cool/stuff/bundle.js'</code>, what will result in <code>/dist/./one/cool/stuff/bundle.js</code>.</p>
<p>So, if we take our initial folder structure, then we can easily create the following entries:</p>
<p>{% highlight javascript %}
{% raw %}
{
 …
 entry: {
     './apps/weather/temperature/bundle.js': './src/apps/weather/temperature/index.js'
        …
    },
    …
}
{% endraw %}
{% endhighlight %}</p>
<p>Looks good and we already know what will be the result of running this.</p>
<p>The bad part is that in this case, all the shared stuff from <code>core</code> and all the modules will be duplicated in each <code>bundle.js</code>. To solve this problem and leave these bundles as slim as possible, we should add one more entry point and utilize one plugin:</p>
<p>{% highlight javascript %}
{% raw %}
{
 …
 entry: {
     './apps/weather/temperature/bundle.js': './src/apps/weather/temperature/index.js'
        …,
        'vendor': [ 'react', 'moment', … ]
    },
    plugins: [
        new webpack.optimize.CommonsChunkPlugin('vendor', 'vendor.js'),
    ]
    …
}
{% endraw %}
{% endhighlight %}</p>
<p>If we want to extract our <code>core</code>, we can write another entry point with name <code>core</code> and use CommonsChunkPlugin one more time. If you want to know more about this plugin, you can check <a href="https://webpack.github.io/docs/list-of-plugins.html#commonschunkplugin">here</a>.</p>
<p>Now we're done with bundling things, but there is always "one more thing".</p>
<h2 id="hotmodulereplacementandreacthotloader">Hot Module Replacement and React Hot Loader</h2>
<p>I will not cover the whole Webpack Dev Server, <a href="https://webpack.github.io/docs/hot-module-replacement.html">HMR</a>, and <a href="https://gaearon.github.io/react-hot-loader/">React Hot Loader</a> thing.</p>
<p>The only thing I'd like to tell here is what you need to do to get all that cool functionality working with a webpack config as we have made earlier.</p>
<p>To start listening to the HMR plugin you have two options: use <code>--inline --hot</code>, kind of Live Reload thing, or add two more items to each entry point:</p>
<p>{% highlight javascript %}
{% raw %}
 './apps/weather/temperature/bundle.js': [
  './src/apps/weather/temperature/index.js'
       'webpack/hot/only-dev-server',
       'webpack-dev-server/client?http://localhost:8080'
   ]
{% endraw %}
{% endhighlight %}</p>
<p>Doing so enables HMR on each entry. But there is still one more thing to do. If you run Webpack Dev Server and try to change a file, you'll see, that HMR expects the changes chunk to be available from the current folder, e.g. <code>http://localhost:8080/apps/weather/temperature/[hash].hot-update.json</code>, what will result in 404 error because by <a href="https://github.com/webpack/webpack/blob/6b0c20a53ad7b04d4282a8a5c334ea0982fd364c/lib/WebpackOptionsDefaulter.js#L55">default</a> Webpack does this:</p>
<p>{% highlight javascript %}
{% raw %}
 this.set("output.hotUpdateChunkFilename", "[id].[hash].hot-update.js");
 this.set("output.hotUpdateMainFilename", "[hash].hot-update.json");
{% endraw %}
{% endhighlight %}</p>
<p>So the needed chunk is available from root path, not from the current directory. The default values are fine when you're developing one app. But while we're dealing with multiple apps, we need to override these settings by understanding where this chunk is:</p>
<p>{% highlight javascript %}
{% raw %}
{
 …
    output: {
     …,
        hotUpdateMainFilename: '../../../[hash].hot-update.json',
        hotUpdateChunkFilename: '../../../[id].[hash].hot-update.js'
    }
    …
}
{% endraw %}
{% endhighlight %}</p>
<p>You can check all default values <a href="https://github.com/webpack/webpack/blob/6b0c20a53ad7b04d4282a8a5c334ea0982fd364c/lib/WebpackOptionsDefaulter.js">here</a>.</p>
<h2 id="conclusion">Conclusion</h2>
<p>Don't forget to extract CSS.</p>
<p>Instead of a conclusion, I'd like to say a few good words about Webpack.</p>
<p>"Just a tool" is great when it does dull and predictable things well. "The Tool" is great when you can use it in uncommon cases.</p>
<p>The JavaScript tooling was always kind of "just a tool" for me, but somehow Webpack managed to become my "The Tool" in a quite short period.</p>
<p>Although the documentation is <em>meh</em>, I <strong>really</strong> encourage you to read the sources, so you'll get the whole picture of how it works and probably find more tricks.</p>
<p>If you know better ways of handling such cases, I'd love to see them in the comments. And don't hesitate to share the post if you find it useful.</p>
<hr />
<h3 id="ps">P.S.</h3>
<p>Why when it comes to more or less complex cases, each and every tutorial/boilerplate/template project is focused on just simple things?</p>
<p>One may say it's up to a developer to find out what to do with his own complicated case. I agree, but I find the fact, that you have close to none information about dealing with this kind of stuff, really disappointing.</p>
<p>I doubt that single page applications are the only thing that people do with JavaScript.</p>
<p>Argh…</p>
<h2 id="update">Update</h2>
<p>I made an example project <a href="https://github.com/kuzzmi/webpack-multiple-entries">on GitHub</a>. Let me know in the comments' section if it's still unclear how to make things work.</p></div><div class="Post_footer__JGzaD">Сподобалась стаття? На чай можна лишити <a href="https://fundof.me/kuzzmi?tip" target="_blank" rel="noreferrer">ось тут</a> 😉</div></div></article></section><div class="PageLayout_flag__XuZGa"><div class="PageLayout_blue__CUemv"></div><div class="PageLayout_yellow__R8WIm"></div></div></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"html":"\u003cp\u003eIn this post, I will try to explain how to handle situations when you need to use \u003ca href=\"https://webpack.js.org/\"\u003eWebpack\u003c/a\u003e with a lot of small apps that share one codebase.\u003c/p\u003e\n\u003cp\u003eIf you want to jump straight to the code, check out my \u003ca href=\"https://github.com/kuzzmi/webpack-multiple-entries\"\u003erepository\u003c/a\u003e on GitHub.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eNOTE:\u003c/strong\u003e Despite the fact that this happened to me already five times, I still consider this as a not typical case. Perhaps I was just \u003cem\u003elucky\u003c/em\u003e.\u003c/p\u003e\n\u003cp\u003eThis is what we'll try to do:\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/uploads/b54e37034d7de6913a4830a9b3e75fc1\" alt=\"\" /\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"/uploads/b54e37034d7de6913a4830a9b3e75fc1\"\u003eLink to the image\u003c/a\u003e\u003c/p\u003e\n\u003ch2 id=\"webpackisyourbro\"\u003eWebpack is your bro\u003c/h2\u003e\n\u003cp\u003eAfter using \u003ca href=\"http://gruntjs.com/\"\u003eGrunt\u003c/a\u003e and \u003ca href=\"http://gulpjs.com/\"\u003eGulp\u003c/a\u003e for building JavaScript apps for quite a while, I find them a little bit meh. If you ask me \"why?\" I won't be able to answer, though. Probably I don't have that good experience with them. Or I do…\u003c/p\u003e\n\u003cp\u003eI can talk a lot about how awesome Webpack is, but to do this I need a whole new post, so let's focus on it and its configuration.\u003c/p\u003e\n\u003cp\u003eImagine that you have two main folders: \u003ccode\u003ecore\u003c/code\u003e and \u003ccode\u003eapps\u003c/code\u003e; the \u003ccode\u003eapps\u003c/code\u003e folder contains 50 micro SAPs. To make things easier, we'll call them widgets. Each widget is grouped by domain, thus one more level of nesting.\u003c/p\u003e\n\u003cp\u003eThe folder structure may look like this, but it can be completely different:\u003c/p\u003e\n\u003cp\u003e{% highlight text %}\n{% raw %}\n~ src/\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003ecore/                          \u0026lt; where all reusable things are\n~ apps/                          \u0026lt; microapps folder\n~ weather/\n  ~ temperature/\n      index.html\n      index.js                 \u0026lt; entry point\n      App.js\n      App.scss\n      ListComponent.js\n      ListComponent.scss\n      ListComponent.spec.js\u003cul\u003e\n\u003cli\u003ehumidity/\u003c/li\u003e\n\u003cli\u003esunrise/\n~ news/\u003c/li\u003e\n\u003cli\u003efeed/\u003c/li\u003e\n\u003cli\u003esport/\n{% endraw %}\n{% endhighlight %}\u003c/li\u003e\u003c/ul\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eAnd that is what we want to get:\n{% highlight text %}\n{% raw %}\n~ dist/\n  ~ weather/\n    ~ temperature/\n        index.html\n        bundle.js\n        bundle.css\n    + humidity/\n    + sunrise/\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003enews/\nvendor.js\nvendor.css\ncore.js\ncore.css\n{% endraw %}\n{% endhighlight %}\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"bundlingbundle\"\u003eBundling bundle\u003c/h2\u003e\n\u003cp\u003eThe very first thing we need for bundling is to get a list of entry points. You can find \u003cem\u003esome\u003c/em\u003e documentation about multiple entry points in Webpack \u003ca href=\"https://webpack.github.io/docs/multiple-entry-points.html\"\u003ehere\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003eIn our case entry points are these multiple \u003ccode\u003eindex.js\u003c/code\u003e files, from which your application starts functioning. Webpack's multiple entry points object follows:\u003c/p\u003e\n\u003cp\u003e{% highlight text %}\n{% raw %}\n{\n entry: {\n     %path\u003cem\u003eto\u003c/em\u003eresult\u003cem\u003efile\u003c/em\u003ename%: %path\u003cem\u003eto\u003c/em\u003eentry\u003cem\u003epoint%,\n        // or\n     %path\u003c/em\u003eto\u003cem\u003eresult\u003c/em\u003efile\u003cem\u003ename%: [ %path\u003c/em\u003eto\u003cem\u003eentry\u003c/em\u003epoint\u003cem\u003e1%, %path\u003c/em\u003eto\u003cem\u003eentry\u003c/em\u003epoint_2% ]\n    }\n}\n{% endraw %}\n{% endhighlight %}\u003c/p\u003e\n\u003cp\u003eWhere \u003ccode\u003epath_to_result_file_name\u003c/code\u003e is a \u003cem\u003epath to the file\u003c/em\u003e we want to get as a result of bundling and \u003ccode\u003epath_to_entry_point\u003c/code\u003e is a path to the file OR a module name which we want to bundle.\u003c/p\u003e\n\u003cp\u003eFor example, assume we have the following configuration:\u003c/p\u003e\n\u003cp\u003e{% highlight javascript %}\n{% raw %}\n{\n …\n    entry: {\n     './one/cool/stuff/bundle.js': './src/another/nested/folder/index.js'\n    },\n    output: {\n        path: path.join(__dirname, 'dist'),\n        filename: '[name].js',\n    },\n    …\n}\n{% endraw %}\n{% endhighlight %}\u003c/p\u003e\n\u003cp\u003eThe result of the \u003ccode\u003ewebpack\u003c/code\u003e will be:\u003c/p\u003e\n\u003cp\u003e{% highlight javascript %}\n{% raw %}\n./\n~ dist\n  ~ one\n    ~ cool\n      ~ stuff\n          bundle.js          \u0026lt; bundled index.js and App.js\n~ src\n  ~ another\n    ~ nested\n      ~ folder\n          index.js\n          App.js             \u0026lt; this file is requested from index.js\nwebpack.config.js\n{% endraw %}\n{% endhighlight %}\u003c/p\u003e\n\u003cp\u003eIf you have a wtf-face, that's fine.\u003c/p\u003e\n\u003cp\u003eIn our case \u003ccode\u003e[name]\u003c/code\u003e was resolved as a \u003ccode\u003e./one/cool/stuff/bundle.js\u003c/code\u003e, the path relative to \u003ccode\u003epath.join(__dirname, 'dist')\u003c/code\u003e. So webpack has written a file to \u003ccode\u003epath.join(__dirname, 'dist') + './one/cool/stuff/bundle.js'\u003c/code\u003e, what will result in \u003ccode\u003e/dist/./one/cool/stuff/bundle.js\u003c/code\u003e.\u003c/p\u003e\n\u003cp\u003eSo, if we take our initial folder structure, then we can easily create the following entries:\u003c/p\u003e\n\u003cp\u003e{% highlight javascript %}\n{% raw %}\n{\n …\n entry: {\n     './apps/weather/temperature/bundle.js': './src/apps/weather/temperature/index.js'\n        …\n    },\n    …\n}\n{% endraw %}\n{% endhighlight %}\u003c/p\u003e\n\u003cp\u003eLooks good and we already know what will be the result of running this.\u003c/p\u003e\n\u003cp\u003eThe bad part is that in this case, all the shared stuff from \u003ccode\u003ecore\u003c/code\u003e and all the modules will be duplicated in each \u003ccode\u003ebundle.js\u003c/code\u003e. To solve this problem and leave these bundles as slim as possible, we should add one more entry point and utilize one plugin:\u003c/p\u003e\n\u003cp\u003e{% highlight javascript %}\n{% raw %}\n{\n …\n entry: {\n     './apps/weather/temperature/bundle.js': './src/apps/weather/temperature/index.js'\n        …,\n        'vendor': [ 'react', 'moment', … ]\n    },\n    plugins: [\n        new webpack.optimize.CommonsChunkPlugin('vendor', 'vendor.js'),\n    ]\n    …\n}\n{% endraw %}\n{% endhighlight %}\u003c/p\u003e\n\u003cp\u003eIf we want to extract our \u003ccode\u003ecore\u003c/code\u003e, we can write another entry point with name \u003ccode\u003ecore\u003c/code\u003e and use CommonsChunkPlugin one more time. If you want to know more about this plugin, you can check \u003ca href=\"https://webpack.github.io/docs/list-of-plugins.html#commonschunkplugin\"\u003ehere\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003eNow we're done with bundling things, but there is always \"one more thing\".\u003c/p\u003e\n\u003ch2 id=\"hotmodulereplacementandreacthotloader\"\u003eHot Module Replacement and React Hot Loader\u003c/h2\u003e\n\u003cp\u003eI will not cover the whole Webpack Dev Server, \u003ca href=\"https://webpack.github.io/docs/hot-module-replacement.html\"\u003eHMR\u003c/a\u003e, and \u003ca href=\"https://gaearon.github.io/react-hot-loader/\"\u003eReact Hot Loader\u003c/a\u003e thing.\u003c/p\u003e\n\u003cp\u003eThe only thing I'd like to tell here is what you need to do to get all that cool functionality working with a webpack config as we have made earlier.\u003c/p\u003e\n\u003cp\u003eTo start listening to the HMR plugin you have two options: use \u003ccode\u003e--inline --hot\u003c/code\u003e, kind of Live Reload thing, or add two more items to each entry point:\u003c/p\u003e\n\u003cp\u003e{% highlight javascript %}\n{% raw %}\n './apps/weather/temperature/bundle.js': [\n  './src/apps/weather/temperature/index.js'\n       'webpack/hot/only-dev-server',\n       'webpack-dev-server/client?http://localhost:8080'\n   ]\n{% endraw %}\n{% endhighlight %}\u003c/p\u003e\n\u003cp\u003eDoing so enables HMR on each entry. But there is still one more thing to do. If you run Webpack Dev Server and try to change a file, you'll see, that HMR expects the changes chunk to be available from the current folder, e.g. \u003ccode\u003ehttp://localhost:8080/apps/weather/temperature/[hash].hot-update.json\u003c/code\u003e, what will result in 404 error because by \u003ca href=\"https://github.com/webpack/webpack/blob/6b0c20a53ad7b04d4282a8a5c334ea0982fd364c/lib/WebpackOptionsDefaulter.js#L55\"\u003edefault\u003c/a\u003e Webpack does this:\u003c/p\u003e\n\u003cp\u003e{% highlight javascript %}\n{% raw %}\n this.set(\"output.hotUpdateChunkFilename\", \"[id].[hash].hot-update.js\");\n this.set(\"output.hotUpdateMainFilename\", \"[hash].hot-update.json\");\n{% endraw %}\n{% endhighlight %}\u003c/p\u003e\n\u003cp\u003eSo the needed chunk is available from root path, not from the current directory. The default values are fine when you're developing one app. But while we're dealing with multiple apps, we need to override these settings by understanding where this chunk is:\u003c/p\u003e\n\u003cp\u003e{% highlight javascript %}\n{% raw %}\n{\n …\n    output: {\n     …,\n        hotUpdateMainFilename: '../../../[hash].hot-update.json',\n        hotUpdateChunkFilename: '../../../[id].[hash].hot-update.js'\n    }\n    …\n}\n{% endraw %}\n{% endhighlight %}\u003c/p\u003e\n\u003cp\u003eYou can check all default values \u003ca href=\"https://github.com/webpack/webpack/blob/6b0c20a53ad7b04d4282a8a5c334ea0982fd364c/lib/WebpackOptionsDefaulter.js\"\u003ehere\u003c/a\u003e.\u003c/p\u003e\n\u003ch2 id=\"conclusion\"\u003eConclusion\u003c/h2\u003e\n\u003cp\u003eDon't forget to extract CSS.\u003c/p\u003e\n\u003cp\u003eInstead of a conclusion, I'd like to say a few good words about Webpack.\u003c/p\u003e\n\u003cp\u003e\"Just a tool\" is great when it does dull and predictable things well. \"The Tool\" is great when you can use it in uncommon cases.\u003c/p\u003e\n\u003cp\u003eThe JavaScript tooling was always kind of \"just a tool\" for me, but somehow Webpack managed to become my \"The Tool\" in a quite short period.\u003c/p\u003e\n\u003cp\u003eAlthough the documentation is \u003cem\u003emeh\u003c/em\u003e, I \u003cstrong\u003ereally\u003c/strong\u003e encourage you to read the sources, so you'll get the whole picture of how it works and probably find more tricks.\u003c/p\u003e\n\u003cp\u003eIf you know better ways of handling such cases, I'd love to see them in the comments. And don't hesitate to share the post if you find it useful.\u003c/p\u003e\n\u003chr /\u003e\n\u003ch3 id=\"ps\"\u003eP.S.\u003c/h3\u003e\n\u003cp\u003eWhy when it comes to more or less complex cases, each and every tutorial/boilerplate/template project is focused on just simple things?\u003c/p\u003e\n\u003cp\u003eOne may say it's up to a developer to find out what to do with his own complicated case. I agree, but I find the fact, that you have close to none information about dealing with this kind of stuff, really disappointing.\u003c/p\u003e\n\u003cp\u003eI doubt that single page applications are the only thing that people do with JavaScript.\u003c/p\u003e\n\u003cp\u003eArgh…\u003c/p\u003e\n\u003ch2 id=\"update\"\u003eUpdate\u003c/h2\u003e\n\u003cp\u003eI made an example project \u003ca href=\"https://github.com/kuzzmi/webpack-multiple-entries\"\u003eon GitHub\u003c/a\u003e. Let me know in the comments' section if it's still unclear how to make things work.\u003c/p\u003e","type":"blog","meta":{"slug":"truly-multiple-entries-with-webpack","title":"Truly Multiple Entries with Webpack","layout":"post","lang":"en","description":"In this post, I will try to explain how to handle situations when you need to use Webpack with a lot of small apps that share one codebase.\n","tags":["technology","react","javascript","web development","webpack","tips"],"date":"2016-06-29 15:16:15 +0200"}},"_nextI18Next":{"initialI18nStore":{"ua":{"common":{"common":{"name":"Ігор Кузьменко","version":"версія","articleFooter":"Сподобалась стаття? На чай можна лишити \u003ca href=\"https://fundof.me/kuzzmi?tip\" target=\"_blank\" rel=\"noreferrer\"\u003eось тут\u003c/a\u003e 😉","articleNotAvailable":"Цей контент доступний тільки англійською мовою."},"menu":{"home":"Головна","blog":"Технічні статті","thoughts":"Роздуми","podcast":"Подкаст","projects":"Проєкти","about":"Про мене"},"home":{"meta":{"description":"Домашня сторінка Ігора Кузьменка"},"bio":"розробник та tech підприємець","read":"Читати","recents":"Останні дописи","description":{"part_1":"Тут я публікую ","part_2":"свої роздуми","part_3":" і ","part_4":" технічні статті","part_5":". Завзятий користувач Linux і vim. Співзасновник в "}},"blog":{"description":"Знахідки і всілякі цікавості, якими я захотів поділитися зі світом."},"thoughts":{"description":"Мої роздуми про життя і роботу."},"tags":{"philosophy":"філософія","psychology":"психологія","story":"моя історія","marketing":"маркетинг","startup":"стартапи","bad advice":"шкідливі поради","career":"кар'єра","work":"робота","burn out":"вигоряння"}}},"en":{"common":{"common":{"name":"Igor Kuzmenko","version":"version","articleFooter":"If you enjoyed the reading, you can tip me \u003ca href=\"https://fundof.me/kuzzmi?tip\" target=\"_blank\" rel=\"noreferrer\"\u003ehere\u003c/a\u003e 😉","articleNotAvailable":"This content is available only in Ukrainian."},"menu":{"home":"Home","blog":"Tech articles","thoughts":"Thoughts","podcast":"Podcast","projects":"Projects","about":"About me"},"home":{"meta":{"description":"Home page of Igor Kuzmenko"},"bio":"developer and tech entrepreneur","read":"Read","recents":"Recent publications","description":{"part_1":"Here I publish ","part_2":"my thoughts","part_3":" and ","part_4":" tech articles","part_5":". Avid Linux and vim user. Co-founder at "}},"blog":{"description":"Different findings in the tech world that I want to share with world."},"thoughts":{"description":"My thoughts about life and work in Ukrainian."}}}},"initialLocale":"ua","userConfig":{"i18n":{"defaultLocale":"en","locales":["en","ua"]},"default":{"i18n":{"defaultLocale":"en","locales":["en","ua"]}}}}},"__N_SSG":true},"page":"/[locale]/blog/[slug]","query":{"locale":"ua","slug":"truly-multiple-entries-with-webpack"},"buildId":"soa2Ej8tkNavLJb66JiCo","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>