{"pageProps":{"post":{"html":"<p>Sometimes in your applications you want to track when the user's PC went to sleep mode, so you can do some routine, such as reestablish the session, or connection. Or your user just opened your app and is doing nothing, but you need to keep the session opened, track connection issues and somehow react on that. So what can we do?</p>\n<p>Answers are pretty simple, but sometimes it takes time to find it.</p>\n<p>Heartbeat and polling are actually almost the same patterns, but I specifically separate them, because it's useful to use appropriate wording.</p>\n<h2 id=\"polling\">Polling</h2>\n<p>This design pattern allows you to let server know that the browser is still opened, and to let your application know that there are no issues with the connection to the server. You can also use this to measure your connection, to track users' network performance and so on.</p>\n<p>For example, you have an application, which has a server that ends inactive sessions <em>(this sounds obviously, but, yes, sometimes they may not do thisâ€¦)</em>. Say that user wants to perform an action that requires him to be authenticated, but his session is invalidated already. In this case user will have errors, or another \"please login\" window, it depends on how you handle this kind of things.</p>\n<p>But we're handling the problem instead of solving it, right? Although sometimes it's enough, but when it comes to the questions of UX, you can find that it's easier to fix it.</p>\n<p>So we need to let server know that \"hey, we're still here\", and let user know that \"hey, Houston, we have a problem\" and let application solve the issue.</p>\n<p>So the simpliest polling can be as easy as this code:</p>\n<pre><code class=\"hljs\">var pollInterval = <span class=\"hljs-number\">60000</span>;\n<span class=\"hljs-keyword\">function</span> poll<span class=\"hljs-literal\">()</span> {\n    set<span class=\"hljs-constructor\">Interval(<span class=\"hljs-params\">function</span>()</span> {\n        <span class=\"hljs-comment\">// We need to make a request</span>\n        <span class=\"hljs-comment\">// I assume that you know how to make GET requests in JavaScript :)</span>\n        make<span class=\"hljs-constructor\">Request(&#x27;<span class=\"hljs-params\">http</span>:<span class=\"hljs-operator\">/</span><span class=\"hljs-operator\">/</span><span class=\"hljs-params\">example</span>.<span class=\"hljs-params\">com</span><span class=\"hljs-operator\">/</span><span class=\"hljs-params\">api</span><span class=\"hljs-operator\">/</span><span class=\"hljs-params\">poll</span>&#x27;)</span>\n            <span class=\"hljs-comment\">// and properly handle the issues</span>\n            .error(handlePollError);\n    }, pollInterval);\n}\n</code></pre>\n<p>That's it. Pretty straightforward, isn't it? The intersting part has to be done in <code>handlePollError</code> function. But it's very specific to each case. I usually suggest to display a message about connection issues, increase the interval timeout and to try to reconnect, until we're connected again.</p>\n<h2 id=\"hearbeat\">Hearbeat</h2>\n<p>Heartbeat pattern is a similar to polling pattern and is used to understand whether the application is alive. In web applications it can be used to detect whether or not a user was in sleep mode and react accordingly. For example, you want to refresh the page if the user's machine was in the sleep mode.</p>\n<p>To do that we may check when was the last time of calling a heartbeat function and if it exceeds the threshold, do what you need to do.</p>\n<pre><code class=\"hljs\"><span class=\"hljs-keyword\">var</span> intervalTime = <span class=\"hljs-number\">1000</span>;\n<span class=\"hljs-keyword\">var</span> <span class=\"hljs-built_in\">now</span> = <span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\"></span>) {\n <span class=\"hljs-keyword\">return</span> (<span class=\"hljs-keyword\">new</span> <span class=\"hljs-built_in\">Date</span>()).getTime();\n};\n\n<span class=\"hljs-keyword\">var</span> lastInterval = <span class=\"hljs-built_in\">now</span>();\n\n<span class=\"hljs-keyword\">var</span> intervalHeartbeat = <span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\"></span>) {\n    <span class=\"hljs-keyword\">var</span> <span class=\"hljs-built_in\">now</span> = <span class=\"hljs-built_in\">now</span>();\n    <span class=\"hljs-keyword\">var</span> diff = <span class=\"hljs-built_in\">now</span> - lastInterval;\n    <span class=\"hljs-keyword\">var</span> <span class=\"hljs-built_in\">offset</span> = diff - intervalTime;\n    lastInterval = <span class=\"hljs-built_in\">now</span>;\n\n    <span class=\"hljs-comment\">// here I check if the difference is more than</span>\n    <span class=\"hljs-comment\">// twenty minutes</span>\n    <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-built_in\">offset</span> &gt; <span class=\"hljs-number\">20</span> * <span class=\"hljs-number\">60</span> * <span class=\"hljs-number\">1000</span>) {\n        window.location.reload(<span class=\"hljs-literal\">true</span>);\n    }\n};\n\nsetInterval(intervalHeartbeat, intervalTime);\n</code></pre>\n<p>That is it.</p>\n<p>This may or may not be the best solutions, but they are used and they help you to fix a bunch of possible issues.</p>\n<p>For curiosity's sake, how do you solve this problems? <a href=\"http://twitter.com/kuzzmi\">Ping me on Twitter</a>.</p>","type":"blog","meta":{"slug":"heartbeat-and-polling","title":"Heartbeat and Polling","layout":"post","lang":"en","description":"Sometimes in your applications you want to track when the user's PC went to sleep mode, so you can do some routine, such as reestablish the session, or connection. Or your user just opened your app and is doing nothing, but you need to keep the session opened. So what can we do?\n","tags":["technology","javascript","tips","web development","patterns"],"date":"2016-01-22 09:28:06 +0200"}},"_nextI18Next":{"initialI18nStore":{"en":{"common":{"common":{"name":"Igor Kuzmenko","version":"version","articleFooter":"If you enjoyed the reading, you can tip me <a href=\"https://fundof.me/kuzzmi?tip\" target=\"_blank\" rel=\"noreferrer\">here</a> ðŸ˜‰","articleNotAvailable":"This content is available only in Ukrainian."},"menu":{"home":"Home","blog":"Tech articles","thoughts":"Thoughts","podcast":"Podcast","projects":"Projects","about":"About me"},"home":{"meta":{"description":"Home page of Igor Kuzmenko"},"bio":"developer and tech entrepreneur","read":"Read","recents":"Recent publications","description":{"part_1":"Here I publish ","part_2":"my thoughts","part_3":" and ","part_4":" tech articles","part_5":". Avid Linux and vim user. Co-founder at "}},"blog":{"description":"Different findings in the tech world that I want to share with world."},"thoughts":{"description":"My thoughts about life and work in Ukrainian."},"about":{"body":"Hi ðŸ‘‹<br /><br />My name is Igor Kuzmenko. I love my wife, son, dog and cat. And I love making things up and making them real (but more often this doesn't happen).<br /><br />For a long time, my personal page seemed like an official paper with a bunch of clichÃ©s, so I got sick of it and turned it into something what feels more like me and my approach to life: a combination of lightness, aesthetics, some seriousness and humor (and modesty).<br /><br />I spend my spare time with my family, doing pet projects, playing video games and more: from playing the ukulele and drawing, to electrical engineering and sports car driving.<br /><br />I've tried countless times to increase my online presence, but it never lasts long ðŸ™ƒ<br /><br />My social networks and contacts are available here: <a href=\"https://fundof.me/igor\">fundof.me/igor</a>"}}}},"initialLocale":"en","userConfig":{"i18n":{"defaultLocale":"en","locales":["en","ua"]},"default":{"i18n":{"defaultLocale":"en","locales":["en","ua"]}}}}},"__N_SSG":true}