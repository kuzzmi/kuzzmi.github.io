<!DOCTYPE html><html lang="en"><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>Creating Ember CLI Addon with External Library. Part 2 | Tech articles | Igor Kuzmenko</title><meta name="robots" content="index,follow"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:creator" content="@kuzzmi"/><meta property="og:title" content="Creating Ember CLI Addon with External Library. Part 2"/><meta property="og:description" content="In this post we will finish development of ember-cli-webfontloader addon and I will describe some issues you might experience during addon development, so you can gain some experience of solving those by reading.
"/><meta property="og:url" content="https://kuzzmi.com/en/blog/creating-ember-cli-addon-with-external-library-part-2"/><meta property="og:type" content="article"/><meta property="article:published_time" content="2016-02-20 13:58:16 +0200"/><meta property="article:author" content="https://kuzzmi.com"/><meta property="article:tag" content="technology"/><meta property="article:tag" content="ember"/><meta property="article:tag" content="javascript"/><meta property="article:tag" content="tutorial"/><link rel="canonical" href="https://kuzzmi.com/en/blog/creating-ember-cli-addon-with-external-library-part-2"/><meta name="next-head-count" content="17"/><link rel="dns-prefetch" href="https://www.googleapis.com"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"/><link rel="apple-touch-icon" sizes="180x180" href="/static/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/static/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/static/favicon-16x16.png"/><link rel="manifest" href="/static/site.webmanifest"/><link rel="shortcut icon" href="/static/favicon.ico" type="image/x-icon"/><meta name="apple-mobile-web-app-capable" content="yes"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.5.0/styles/base16/railscasts.min.css"/><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.5.0/highlight.min.js"></script><meta name="author" content="Igor Kuzmenko"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin /><link rel="preload" href="/_next/static/css/8d3077ef275150e2.css" as="style"/><link rel="stylesheet" href="/_next/static/css/8d3077ef275150e2.css" data-n-g=""/><link rel="preload" href="/_next/static/css/5efee9f793991289.css" as="style"/><link rel="stylesheet" href="/_next/static/css/5efee9f793991289.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-69bfa6990bb9e155.js" defer=""></script><script src="/_next/static/chunks/framework-fc97f3f1282ce3ed.js" defer=""></script><script src="/_next/static/chunks/main-551bef8982a15171.js" defer=""></script><script src="/_next/static/chunks/pages/_app-84072d5e9d49e694.js" defer=""></script><script src="/_next/static/chunks/47-1461360545d2f08c.js" defer=""></script><script src="/_next/static/chunks/962-41b19898a46b0b4f.js" defer=""></script><script src="/_next/static/chunks/pages/%5Blocale%5D/blog/%5Bslug%5D-cde7d66f922c46b8.js" defer=""></script><script src="/_next/static/s_On4rM-yupbqrR83MUiz/_buildManifest.js" defer=""></script><script src="/_next/static/s_On4rM-yupbqrR83MUiz/_ssgManifest.js" defer=""></script><script src="/_next/static/s_On4rM-yupbqrR83MUiz/_middlewareManifest.js" defer=""></script><style data-href="https://fonts.googleapis.com/css2?family=JetBrains+Mono&family=PT+Sans:ital,wght@0,400;0,700;1,400&display=swap">@font-face{font-family:'JetBrains Mono';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/jetbrainsmono/v11/tDbY2o-flEEny0FZhsfKu5WU4zr3E_BX0PnT8RD8yKxjPg.woff) format('woff')}@font-face{font-family:'PT Sans';font-style:italic;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/ptsans/v16/jizYRExUiTo99u79D0eEww.woff) format('woff')}@font-face{font-family:'PT Sans';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/ptsans/v16/jizaRExUiTo99u79P0Y.woff) format('woff')}@font-face{font-family:'PT Sans';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/ptsans/v16/jizfRExUiTo99u79B_mh4Oo.woff) format('woff')}@font-face{font-family:'JetBrains Mono';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/jetbrainsmono/v11/tDbY2o-flEEny0FZhsfKu5WU4zr3E_BX0PnT8RD8yKxTN1OTk6OThhvAWV8.woff) format('woff');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'JetBrains Mono';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/jetbrainsmono/v11/tDbY2o-flEEny0FZhsfKu5WU4zr3E_BX0PnT8RD8yKxTPlOTk6OThhvAWV8.woff) format('woff');unicode-range:U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'JetBrains Mono';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/jetbrainsmono/v11/tDbY2o-flEEny0FZhsfKu5WU4zr3E_BX0PnT8RD8yKxTOVOTk6OThhvAWV8.woff) format('woff');unicode-range:U+0370-03FF}@font-face{font-family:'JetBrains Mono';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/jetbrainsmono/v11/tDbY2o-flEEny0FZhsfKu5WU4zr3E_BX0PnT8RD8yKxTNVOTk6OThhvAWV8.woff) format('woff');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:'JetBrains Mono';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/jetbrainsmono/v11/tDbY2o-flEEny0FZhsfKu5WU4zr3E_BX0PnT8RD8yKxTNFOTk6OThhvAWV8.woff) format('woff');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'JetBrains Mono';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/jetbrainsmono/v11/tDbY2o-flEEny0FZhsfKu5WU4zr3E_BX0PnT8RD8yKxTOlOTk6OThhvA.woff) format('woff');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'PT Sans';font-style:italic;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/ptsans/v16/jizYRExUiTo99u79D0e0ysmIAjcQ-woy.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'PT Sans';font-style:italic;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/ptsans/v16/jizYRExUiTo99u79D0e0w8mIAjcQ-woy.woff2) format('woff2');unicode-range:U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'PT Sans';font-style:italic;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/ptsans/v16/jizYRExUiTo99u79D0e0ycmIAjcQ-woy.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'PT Sans';font-style:italic;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/ptsans/v16/jizYRExUiTo99u79D0e0x8mIAjcQ-w.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'PT Sans';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/ptsans/v16/jizaRExUiTo99u79D0-ExcOPIDUg-g.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'PT Sans';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/ptsans/v16/jizaRExUiTo99u79D0aExcOPIDUg-g.woff2) format('woff2');unicode-range:U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'PT Sans';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/ptsans/v16/jizaRExUiTo99u79D0yExcOPIDUg-g.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'PT Sans';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/ptsans/v16/jizaRExUiTo99u79D0KExcOPIDU.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'PT Sans';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/ptsans/v16/jizfRExUiTo99u79B_mh0OOtLR8a8zILig.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'PT Sans';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/ptsans/v16/jizfRExUiTo99u79B_mh0OqtLR8a8zILig.woff2) format('woff2');unicode-range:U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'PT Sans';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/ptsans/v16/jizfRExUiTo99u79B_mh0OCtLR8a8zILig.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'PT Sans';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/ptsans/v16/jizfRExUiTo99u79B_mh0O6tLR8a8zI.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}</style></head><body><div id="__next"><main class="PageLayout_page_container__M8QGN "><menu class="PageLayout_menu_container__La6NU"><ul><li class="PageLayout_inactive__g2bTn"><a href="/en">Home</a></li><li><a href="/en/blog">Tech articles</a></li><li class="PageLayout_inactive__g2bTn"><a href="/en/thoughts">Thoughts</a></li></ul></menu><section class="PageLayout_content_container__1IMZI"><header class="PageLayout_header_container__Y6dbq"><div><div class="PageLayout_menu_button__vWi4y"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24px" height="24px"><path fill="none" stroke="#000000" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M3 12L21 12M3 6L21 6M3 18L21 18"></path></svg></div><p class="PageLayout_name__xhUaP"></p></div><div class="PageLayout_lang_switcher___L3bH"><p class="PageLayout_version__2_iha">version<!-- -->:<!-- --></p><div class="PageLayout_langs__z_SxD"><a class="" href="/ua/blog/creating-ember-cli-addon-with-external-library-part-2">🇺🇦</a><a class="PageLayout_active__UxQoO" href="/en/blog/creating-ember-cli-addon-with-external-library-part-2">🇬🇧</a></div></div></header><article class="PageLayout_content__6Pdc3"><div class="Post_container__jmeoa"><h1>Creating Ember CLI Addon with External Library. Part 2</h1><p class="Post_date__B7bMG">2/20/2016, 1:58:16 PM</p><div><p>In my <a href="https://kuzzmi.com/blog/creating-ember-cli-addon-with-external-library-part-2">previous post</a> I covered basics about how to wrap the third-party library in <a href="http://www.ember-cli.com">Ember CLI</a> addon, so it can be reusable, and used in Ember-way.</p>
<p><strong>Note</strong>: This article will cover only a few issues that you might face during addon development, so I wouldn't say that it's a tutorial.</p>
<p>In this part I will try to finish the <a href="https://github.com/kuzzmi/ember-cli-webfontloader">ember-cli-webfontloader</a> addon by doing following:</p>
<ul>
<li>trying to find a nice solution of managing weird WebFontLoader's event system logic</li>
<li>restructuring the addon to isolate it a bit more</li>
</ul>
<h2 id="problem">Problem</h2>
<p>After reading the <a href="https://github.com/typekit/webfontloader">WebFontLoader</a> docs, I found that they are using probably the strangest event system you can find out there. The problem is that you need to use either a global variable or you need to pass configuration directly to <code>.load()</code> function which we use to load fonts.</p>
<p>In our case, we want the configuration to contain only the fonts we want to load, so we need to find a way of having something more flexible.</p>
<p>My first idea was to create a service that will attach its generic functions to configuration object, which will call our "real" event callbacks on event. But unfortunately this idea failed after a few atempts as I couldn't find a way of injecting a service to initializer, so I decided to go a bit lame way, I decided to extend <code>WebFont</code> object.</p>
<p>We need to track somehow the state of WebFontLoader, add event handlers and if the event is already active (such as <code>active</code>, <code>loading</code> etc.) we need to be able to run the callback immediately. I will implement two functions: <code>on(string event, function callback, boolean runIfActive)</code> and <code>off(string event, function callback)</code>.</p>
<p>Idea is such that <code>on()</code> function will add callbacks to the list and when an event is fired, the main event handler will execute all callbacks from the appropriate list.</p>
<p>The full list of events is:</p>
<ul>
<li>loading</li>
<li>active</li>
<li>inactive</li>
<li>fontloading</li>
<li>fontactive</li>
<li>fontinactive</li>
</ul>
<p>Here I will focus on covering the first three events: loading, active, inactive.</p>
<h2 id="solution">Solution</h2>
<p>Let's outline the extension to the library:</p>
<pre class="javascript language-javascript"><code class="hljs javascript language-javascript"><span class="hljs-comment">// ember-cli-webfontloader/app/initializers/ember-cli-webfontloader.js</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">initialize</span>(<span class="hljs-params">...</span>) {
  ...
  <span class="hljs-keyword">let</span> events = {
      <span class="hljs-comment">// current state of WebFontLoader</span>
      <span class="hljs-attr">state</span>: <span class="hljs-literal">null</span>,

      <span class="hljs-comment">// Collection of callback functions to be called</span>
      <span class="hljs-comment">// when the appropriate event is fired</span>
      <span class="hljs-attr">eventHandlers</span>: {
          <span class="hljs-attr">active</span>: [],
          <span class="hljs-attr">inactive</span>: [],
          <span class="hljs-attr">loading</span>: [],
      },

      <span class="hljs-comment">// Real `active` callback</span>
      <span class="hljs-title function_">onActive</span>(<span class="hljs-params"></span>) {  events.<span class="hljs-property">state</span> = <span class="hljs-string">&#x27;active&#x27;</span>; },

      <span class="hljs-comment">// Real `inactive` callback</span>
      <span class="hljs-title function_">onInactive</span>(<span class="hljs-params"></span>) {  events.<span class="hljs-property">state</span> = <span class="hljs-string">&#x27;inactive&#x27;</span>; },

      <span class="hljs-comment">// Real `loading` callback</span>
      <span class="hljs-title function_">onLoading</span>(<span class="hljs-params"></span>) {  events.<span class="hljs-property">state</span> = <span class="hljs-string">&#x27;loading&#x27;</span>; }
  };
  ...
}
</code></pre>
<p>To extend the plugin in a good manner, we need to have some sort of an isolated container. Let's call ours <code>__events__</code>:</p>
<pre class="javascript language-javascript"><code class="hljs javascript language-javascript"><span class="hljs-comment">// ember-cli-webfontloader/app/initializers/ember-cli-webfontloader.js</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">initialize</span>(<span class="hljs-params">...</span>) {
  ...
  <span class="hljs-comment">// Extending WebFont</span>
  <span class="hljs-title class_">WebFont</span>.<span class="hljs-property">__events__</span> = events;
  ...
}
</code></pre>
<p>And let's define our <code>on()</code> function directly on the <code>WebFont</code> object so in can be accessable from outer world:</p>
<pre class="javascript language-javascript"><code class="hljs javascript language-javascript"><span class="hljs-comment">// ember-cli-webfontloader/app/initializers/ember-cli-webfontloader.js</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">initialize</span>(<span class="hljs-params">...</span>) {
  ...
  <span class="hljs-comment">// Adds a callback to the eventHandlers[event] list and</span>
  <span class="hljs-comment">// if &quot;toRun&quot; is true and the current state is event name,</span>
  <span class="hljs-comment">// we need to run callback function after we add it to the list</span>
  <span class="hljs-title class_">WebFont</span>.<span class="hljs-property">on</span> = <span class="hljs-function">(<span class="hljs-params">event, callback, toRun</span>) =&gt;</span> {
    <span class="hljs-comment">// Adding new handler to the list</span>
    <span class="hljs-title class_">WebFont</span>.<span class="hljs-property">__events__</span>.<span class="hljs-property">eventHandlers</span>[event].<span class="hljs-title function_">push</span>(callback);

    <span class="hljs-comment">// Checking if we should run it now</span>
    <span class="hljs-keyword">if</span> (toRun &amp;&amp; event === <span class="hljs-title class_">WebFont</span>.<span class="hljs-property">__events__</span>.<span class="hljs-property">state</span>) {
        <span class="hljs-title function_">callback</span>();
    }
  };
  ...
}
</code></pre>
<p>Cool, looks promising. Now we need to attach these <code>onActive</code>, <code>onInactive</code> and <code>onLoading</code> functions to the WebFontLoader configuration object.</p>
<pre class="javascript language-javascript"><code class="hljs javascript language-javascript"><span class="hljs-comment">// ember-cli-webfontloader/app/initializers/ember-cli-webfontloader.js</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">initialize</span>(<span class="hljs-params">...</span>) {
    ...
 <span class="hljs-comment">// Getting all font families that should be loaded from</span>
    <span class="hljs-comment">// configuration</span>
    <span class="hljs-keyword">let</span> config = <span class="hljs-title class_">Ember</span>.<span class="hljs-title function_">get</span>(<span class="hljs-variable constant_">ENV</span>, <span class="hljs-string">&#x27;webFontConfig&#x27;</span>) || {};

    config.<span class="hljs-property">loading</span> = events.<span class="hljs-property">onLoading</span>;
    config.<span class="hljs-property">active</span> = events.<span class="hljs-property">onActive</span>;
    config.<span class="hljs-property">inactive</span> = events.<span class="hljs-property">onInactive</span>;

    <span class="hljs-title class_">WebFont</span>.<span class="hljs-title function_">load</span>(config);
    ...
}
</code></pre>
<p>After these steps we can inject the <code>WebFont</code> object to the component/route/whatever and do the following:</p>
<pre class="javascript language-javascript"><code class="hljs javascript language-javascript"><span class="hljs-comment">// ember-cli-webfontloader/tests/dummy/app/routes/application.js</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Ember</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;ember&#x27;</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">WebFont</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;webfontloader&#x27;</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">Ember</span>.<span class="hljs-property">Route</span>.<span class="hljs-title function_">extend</span>({
    <span class="hljs-attr">actions</span>: {
        <span class="hljs-title function_">didTransition</span>(<span class="hljs-params"></span>) {
            <span class="hljs-title class_">WebFont</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;inactive&#x27;</span>, <span class="hljs-function">() =&gt;</span> {
                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;inactive!&#x27;</span>);
            }, <span class="hljs-literal">true</span>);
            <span class="hljs-title class_">WebFont</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;loading&#x27;</span>, <span class="hljs-function">() =&gt;</span> {
                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;loading!&#x27;</span>);
            }, <span class="hljs-literal">true</span>);
            <span class="hljs-title class_">WebFont</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;active&#x27;</span>, <span class="hljs-function">() =&gt;</span> {
                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;active!&#x27;</span>);
            }, <span class="hljs-literal">true</span>);
        }
    }
});
</code></pre>
<p>By doing this we will create event handlers that will be executed on each of three events we covered here: loading, active, inactive.</p>
<h2 id="goodpractice">Good Practice</h2>
<p>As some of you could notice, we're injecting our initializer directly to the application namespace, which is not a good idea, let's keep our application namespace for an application.</p>
<p>We'll create a new file <code>addon/initializers/ember-cli-webfontloader.js</code> and copy the contents of the according file from <code>app/</code> folder and switch from exporting an initializer to export a function that will accept a configuration file, to which we have access only from <code>app</code> namespace:</p>
<pre class="javascript language-javascript"><code class="hljs javascript language-javascript"><span class="hljs-comment">// addon/initializers/ember-cli-webfontloader.js</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">WebFont</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;webfontloader&#x27;</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">setupWebFont</span>(<span class="hljs-params">config</span>) {
    <span class="hljs-comment">// Extending WebFont</span>
    <span class="hljs-keyword">let</span> events = {
        ...
    };

    <span class="hljs-comment">// Setting up our functions</span>
    config.<span class="hljs-property">loading</span>      = events.<span class="hljs-property">onLoading</span>;
    config.<span class="hljs-property">active</span>       = events.<span class="hljs-property">onActive</span>;
    config.<span class="hljs-property">inactive</span>     = events.<span class="hljs-property">onInactive</span>;
    config.<span class="hljs-property">fontloading</span>  = events.<span class="hljs-property">onFontloading</span>;
    config.<span class="hljs-property">fontactive</span>   = events.<span class="hljs-property">onFontactive</span>;
    config.<span class="hljs-property">fontinactive</span> = events.<span class="hljs-property">onFontinactive</span>;

    <span class="hljs-comment">// Load with an updated configuration</span>
    <span class="hljs-title class_">WebFont</span>.<span class="hljs-title function_">load</span>(config);
}
</code></pre>
<p>After doing that we still need to export an initializer to <code>app</code> namespace, but we'll do this more gently:</p>
<pre><code class="hljs"><span class="hljs-comment">// app/initializers/ember-cli-webfontloader.js</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Ember</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;ember&#x27;</span>;
<span class="hljs-keyword">import</span> <span class="hljs-variable constant_">ENV</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../config/environment&#x27;</span>;
<span class="hljs-keyword">import</span> setupWebFont <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;ember-cli-webfontloader/initializers/ember-cli-webfontloader&#x27;</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
    <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;ember-cli-webfontloader&#x27;</span>,
    <span class="hljs-title function_">initialize</span>(<span class="hljs-params"></span>) {
        <span class="hljs-keyword">const</span> config = <span class="hljs-title class_">Ember</span>.<span class="hljs-title function_">get</span>(<span class="hljs-variable constant_">ENV</span>, <span class="hljs-string">&#x27;webFontConfig&#x27;</span>) || {};
        <span class="hljs-title function_">setupWebFont</span>(config);
    }
};
</code></pre>
<p>Ok, that's it, we keep our <em>actual</em> initializer in <code>addon/</code> folder and here we just pass environment configuration.</p>
<p>Done.</p>
<p>If you have any comments and/or found some lame mistakes here, please let me know in the comments section below.</p>
<h2 id="links">Links</h2>
<ul>
<li><a href="https://github.com/kuzzmi/ember-cli-webfontloader">ember-cli-webfontloader - GitHub</a> (here you can find sources of the plugin)</li>
<li><a href="https://github.com/typekit/webfontloader">WebFontLoader - GitHub</a></li>
</ul></div><div class="Post_footer__JGzaD">If you enjoyed the reading, you can tip me <a href="https://fundof.me/kuzzmi?tip" target="_blank" rel="noreferrer">here</a> 😉</div></div></article></section><div class="PageLayout_flag__XuZGa"><div class="PageLayout_blue__CUemv"></div><div class="PageLayout_yellow__R8WIm"></div></div></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"html":"\u003cp\u003eIn my \u003ca href=\"https://kuzzmi.com/blog/creating-ember-cli-addon-with-external-library-part-2\"\u003eprevious post\u003c/a\u003e I covered basics about how to wrap the third-party library in \u003ca href=\"http://www.ember-cli.com\"\u003eEmber CLI\u003c/a\u003e addon, so it can be reusable, and used in Ember-way.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eNote\u003c/strong\u003e: This article will cover only a few issues that you might face during addon development, so I wouldn't say that it's a tutorial.\u003c/p\u003e\n\u003cp\u003eIn this part I will try to finish the \u003ca href=\"https://github.com/kuzzmi/ember-cli-webfontloader\"\u003eember-cli-webfontloader\u003c/a\u003e addon by doing following:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003etrying to find a nice solution of managing weird WebFontLoader's event system logic\u003c/li\u003e\n\u003cli\u003erestructuring the addon to isolate it a bit more\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"problem\"\u003eProblem\u003c/h2\u003e\n\u003cp\u003eAfter reading the \u003ca href=\"https://github.com/typekit/webfontloader\"\u003eWebFontLoader\u003c/a\u003e docs, I found that they are using probably the strangest event system you can find out there. The problem is that you need to use either a global variable or you need to pass configuration directly to \u003ccode\u003e.load()\u003c/code\u003e function which we use to load fonts.\u003c/p\u003e\n\u003cp\u003eIn our case, we want the configuration to contain only the fonts we want to load, so we need to find a way of having something more flexible.\u003c/p\u003e\n\u003cp\u003eMy first idea was to create a service that will attach its generic functions to configuration object, which will call our \"real\" event callbacks on event. But unfortunately this idea failed after a few atempts as I couldn't find a way of injecting a service to initializer, so I decided to go a bit lame way, I decided to extend \u003ccode\u003eWebFont\u003c/code\u003e object.\u003c/p\u003e\n\u003cp\u003eWe need to track somehow the state of WebFontLoader, add event handlers and if the event is already active (such as \u003ccode\u003eactive\u003c/code\u003e, \u003ccode\u003eloading\u003c/code\u003e etc.) we need to be able to run the callback immediately. I will implement two functions: \u003ccode\u003eon(string event, function callback, boolean runIfActive)\u003c/code\u003e and \u003ccode\u003eoff(string event, function callback)\u003c/code\u003e.\u003c/p\u003e\n\u003cp\u003eIdea is such that \u003ccode\u003eon()\u003c/code\u003e function will add callbacks to the list and when an event is fired, the main event handler will execute all callbacks from the appropriate list.\u003c/p\u003e\n\u003cp\u003eThe full list of events is:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eloading\u003c/li\u003e\n\u003cli\u003eactive\u003c/li\u003e\n\u003cli\u003einactive\u003c/li\u003e\n\u003cli\u003efontloading\u003c/li\u003e\n\u003cli\u003efontactive\u003c/li\u003e\n\u003cli\u003efontinactive\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eHere I will focus on covering the first three events: loading, active, inactive.\u003c/p\u003e\n\u003ch2 id=\"solution\"\u003eSolution\u003c/h2\u003e\n\u003cp\u003eLet's outline the extension to the library:\u003c/p\u003e\n\u003cpre class=\"javascript language-javascript\"\u003e\u003ccode class=\"hljs javascript language-javascript\"\u003e\u003cspan class=\"hljs-comment\"\u003e// ember-cli-webfontloader/app/initializers/ember-cli-webfontloader.js\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003einitialize\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e...\u003c/span\u003e) {\n  ...\n  \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e events = {\n      \u003cspan class=\"hljs-comment\"\u003e// current state of WebFontLoader\u003c/span\u003e\n      \u003cspan class=\"hljs-attr\"\u003estate\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e,\n\n      \u003cspan class=\"hljs-comment\"\u003e// Collection of callback functions to be called\u003c/span\u003e\n      \u003cspan class=\"hljs-comment\"\u003e// when the appropriate event is fired\u003c/span\u003e\n      \u003cspan class=\"hljs-attr\"\u003eeventHandlers\u003c/span\u003e: {\n          \u003cspan class=\"hljs-attr\"\u003eactive\u003c/span\u003e: [],\n          \u003cspan class=\"hljs-attr\"\u003einactive\u003c/span\u003e: [],\n          \u003cspan class=\"hljs-attr\"\u003eloading\u003c/span\u003e: [],\n      },\n\n      \u003cspan class=\"hljs-comment\"\u003e// Real `active` callback\u003c/span\u003e\n      \u003cspan class=\"hljs-title function_\"\u003eonActive\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) {  events.\u003cspan class=\"hljs-property\"\u003estate\u003c/span\u003e = \u003cspan class=\"hljs-string\"\u003e\u0026#x27;active\u0026#x27;\u003c/span\u003e; },\n\n      \u003cspan class=\"hljs-comment\"\u003e// Real `inactive` callback\u003c/span\u003e\n      \u003cspan class=\"hljs-title function_\"\u003eonInactive\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) {  events.\u003cspan class=\"hljs-property\"\u003estate\u003c/span\u003e = \u003cspan class=\"hljs-string\"\u003e\u0026#x27;inactive\u0026#x27;\u003c/span\u003e; },\n\n      \u003cspan class=\"hljs-comment\"\u003e// Real `loading` callback\u003c/span\u003e\n      \u003cspan class=\"hljs-title function_\"\u003eonLoading\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) {  events.\u003cspan class=\"hljs-property\"\u003estate\u003c/span\u003e = \u003cspan class=\"hljs-string\"\u003e\u0026#x27;loading\u0026#x27;\u003c/span\u003e; }\n  };\n  ...\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eTo extend the plugin in a good manner, we need to have some sort of an isolated container. Let's call ours \u003ccode\u003e__events__\u003c/code\u003e:\u003c/p\u003e\n\u003cpre class=\"javascript language-javascript\"\u003e\u003ccode class=\"hljs javascript language-javascript\"\u003e\u003cspan class=\"hljs-comment\"\u003e// ember-cli-webfontloader/app/initializers/ember-cli-webfontloader.js\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003einitialize\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e...\u003c/span\u003e) {\n  ...\n  \u003cspan class=\"hljs-comment\"\u003e// Extending WebFont\u003c/span\u003e\n  \u003cspan class=\"hljs-title class_\"\u003eWebFont\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003e__events__\u003c/span\u003e = events;\n  ...\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eAnd let's define our \u003ccode\u003eon()\u003c/code\u003e function directly on the \u003ccode\u003eWebFont\u003c/code\u003e object so in can be accessable from outer world:\u003c/p\u003e\n\u003cpre class=\"javascript language-javascript\"\u003e\u003ccode class=\"hljs javascript language-javascript\"\u003e\u003cspan class=\"hljs-comment\"\u003e// ember-cli-webfontloader/app/initializers/ember-cli-webfontloader.js\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003einitialize\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e...\u003c/span\u003e) {\n  ...\n  \u003cspan class=\"hljs-comment\"\u003e// Adds a callback to the eventHandlers[event] list and\u003c/span\u003e\n  \u003cspan class=\"hljs-comment\"\u003e// if \u0026quot;toRun\u0026quot; is true and the current state is event name,\u003c/span\u003e\n  \u003cspan class=\"hljs-comment\"\u003e// we need to run callback function after we add it to the list\u003c/span\u003e\n  \u003cspan class=\"hljs-title class_\"\u003eWebFont\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eon\u003c/span\u003e = \u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003eevent, callback, toRun\u003c/span\u003e) =\u0026gt;\u003c/span\u003e {\n    \u003cspan class=\"hljs-comment\"\u003e// Adding new handler to the list\u003c/span\u003e\n    \u003cspan class=\"hljs-title class_\"\u003eWebFont\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003e__events__\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eeventHandlers\u003c/span\u003e[event].\u003cspan class=\"hljs-title function_\"\u003epush\u003c/span\u003e(callback);\n\n    \u003cspan class=\"hljs-comment\"\u003e// Checking if we should run it now\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (toRun \u0026amp;\u0026amp; event === \u003cspan class=\"hljs-title class_\"\u003eWebFont\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003e__events__\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003estate\u003c/span\u003e) {\n        \u003cspan class=\"hljs-title function_\"\u003ecallback\u003c/span\u003e();\n    }\n  };\n  ...\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eCool, looks promising. Now we need to attach these \u003ccode\u003eonActive\u003c/code\u003e, \u003ccode\u003eonInactive\u003c/code\u003e and \u003ccode\u003eonLoading\u003c/code\u003e functions to the WebFontLoader configuration object.\u003c/p\u003e\n\u003cpre class=\"javascript language-javascript\"\u003e\u003ccode class=\"hljs javascript language-javascript\"\u003e\u003cspan class=\"hljs-comment\"\u003e// ember-cli-webfontloader/app/initializers/ember-cli-webfontloader.js\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003einitialize\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e...\u003c/span\u003e) {\n    ...\n \u003cspan class=\"hljs-comment\"\u003e// Getting all font families that should be loaded from\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e// configuration\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e config = \u003cspan class=\"hljs-title class_\"\u003eEmber\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eget\u003c/span\u003e(\u003cspan class=\"hljs-variable constant_\"\u003eENV\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026#x27;webFontConfig\u0026#x27;\u003c/span\u003e) || {};\n\n    config.\u003cspan class=\"hljs-property\"\u003eloading\u003c/span\u003e = events.\u003cspan class=\"hljs-property\"\u003eonLoading\u003c/span\u003e;\n    config.\u003cspan class=\"hljs-property\"\u003eactive\u003c/span\u003e = events.\u003cspan class=\"hljs-property\"\u003eonActive\u003c/span\u003e;\n    config.\u003cspan class=\"hljs-property\"\u003einactive\u003c/span\u003e = events.\u003cspan class=\"hljs-property\"\u003eonInactive\u003c/span\u003e;\n\n    \u003cspan class=\"hljs-title class_\"\u003eWebFont\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eload\u003c/span\u003e(config);\n    ...\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eAfter these steps we can inject the \u003ccode\u003eWebFont\u003c/code\u003e object to the component/route/whatever and do the following:\u003c/p\u003e\n\u003cpre class=\"javascript language-javascript\"\u003e\u003ccode class=\"hljs javascript language-javascript\"\u003e\u003cspan class=\"hljs-comment\"\u003e// ember-cli-webfontloader/tests/dummy/app/routes/application.js\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eEmber\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026#x27;ember\u0026#x27;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { \u003cspan class=\"hljs-title class_\"\u003eWebFont\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026#x27;webfontloader\u0026#x27;\u003c/span\u003e;\n\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edefault\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eEmber\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eRoute\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eextend\u003c/span\u003e({\n    \u003cspan class=\"hljs-attr\"\u003eactions\u003c/span\u003e: {\n        \u003cspan class=\"hljs-title function_\"\u003edidTransition\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) {\n            \u003cspan class=\"hljs-title class_\"\u003eWebFont\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eon\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;inactive\u0026#x27;\u003c/span\u003e, \u003cspan class=\"hljs-function\"\u003e() =\u0026gt;\u003c/span\u003e {\n                \u003cspan class=\"hljs-variable language_\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003elog\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;inactive!\u0026#x27;\u003c/span\u003e);\n            }, \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e);\n            \u003cspan class=\"hljs-title class_\"\u003eWebFont\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eon\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;loading\u0026#x27;\u003c/span\u003e, \u003cspan class=\"hljs-function\"\u003e() =\u0026gt;\u003c/span\u003e {\n                \u003cspan class=\"hljs-variable language_\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003elog\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;loading!\u0026#x27;\u003c/span\u003e);\n            }, \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e);\n            \u003cspan class=\"hljs-title class_\"\u003eWebFont\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eon\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;active\u0026#x27;\u003c/span\u003e, \u003cspan class=\"hljs-function\"\u003e() =\u0026gt;\u003c/span\u003e {\n                \u003cspan class=\"hljs-variable language_\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003elog\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;active!\u0026#x27;\u003c/span\u003e);\n            }, \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e);\n        }\n    }\n});\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eBy doing this we will create event handlers that will be executed on each of three events we covered here: loading, active, inactive.\u003c/p\u003e\n\u003ch2 id=\"goodpractice\"\u003eGood Practice\u003c/h2\u003e\n\u003cp\u003eAs some of you could notice, we're injecting our initializer directly to the application namespace, which is not a good idea, let's keep our application namespace for an application.\u003c/p\u003e\n\u003cp\u003eWe'll create a new file \u003ccode\u003eaddon/initializers/ember-cli-webfontloader.js\u003c/code\u003e and copy the contents of the according file from \u003ccode\u003eapp/\u003c/code\u003e folder and switch from exporting an initializer to export a function that will accept a configuration file, to which we have access only from \u003ccode\u003eapp\u003c/code\u003e namespace:\u003c/p\u003e\n\u003cpre class=\"javascript language-javascript\"\u003e\u003ccode class=\"hljs javascript language-javascript\"\u003e\u003cspan class=\"hljs-comment\"\u003e// addon/initializers/ember-cli-webfontloader.js\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { \u003cspan class=\"hljs-title class_\"\u003eWebFont\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026#x27;webfontloader\u0026#x27;\u003c/span\u003e;\n\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edefault\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003esetupWebFont\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003econfig\u003c/span\u003e) {\n    \u003cspan class=\"hljs-comment\"\u003e// Extending WebFont\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e events = {\n        ...\n    };\n\n    \u003cspan class=\"hljs-comment\"\u003e// Setting up our functions\u003c/span\u003e\n    config.\u003cspan class=\"hljs-property\"\u003eloading\u003c/span\u003e      = events.\u003cspan class=\"hljs-property\"\u003eonLoading\u003c/span\u003e;\n    config.\u003cspan class=\"hljs-property\"\u003eactive\u003c/span\u003e       = events.\u003cspan class=\"hljs-property\"\u003eonActive\u003c/span\u003e;\n    config.\u003cspan class=\"hljs-property\"\u003einactive\u003c/span\u003e     = events.\u003cspan class=\"hljs-property\"\u003eonInactive\u003c/span\u003e;\n    config.\u003cspan class=\"hljs-property\"\u003efontloading\u003c/span\u003e  = events.\u003cspan class=\"hljs-property\"\u003eonFontloading\u003c/span\u003e;\n    config.\u003cspan class=\"hljs-property\"\u003efontactive\u003c/span\u003e   = events.\u003cspan class=\"hljs-property\"\u003eonFontactive\u003c/span\u003e;\n    config.\u003cspan class=\"hljs-property\"\u003efontinactive\u003c/span\u003e = events.\u003cspan class=\"hljs-property\"\u003eonFontinactive\u003c/span\u003e;\n\n    \u003cspan class=\"hljs-comment\"\u003e// Load with an updated configuration\u003c/span\u003e\n    \u003cspan class=\"hljs-title class_\"\u003eWebFont\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eload\u003c/span\u003e(config);\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eAfter doing that we still need to export an initializer to \u003ccode\u003eapp\u003c/code\u003e namespace, but we'll do this more gently:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs\"\u003e\u003cspan class=\"hljs-comment\"\u003e// app/initializers/ember-cli-webfontloader.js\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eEmber\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026#x27;ember\u0026#x27;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-variable constant_\"\u003eENV\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026#x27;../config/environment\u0026#x27;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e setupWebFont \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026#x27;ember-cli-webfontloader/initializers/ember-cli-webfontloader\u0026#x27;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edefault\u003c/span\u003e {\n    \u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026#x27;ember-cli-webfontloader\u0026#x27;\u003c/span\u003e,\n    \u003cspan class=\"hljs-title function_\"\u003einitialize\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) {\n        \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e config = \u003cspan class=\"hljs-title class_\"\u003eEmber\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eget\u003c/span\u003e(\u003cspan class=\"hljs-variable constant_\"\u003eENV\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026#x27;webFontConfig\u0026#x27;\u003c/span\u003e) || {};\n        \u003cspan class=\"hljs-title function_\"\u003esetupWebFont\u003c/span\u003e(config);\n    }\n};\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eOk, that's it, we keep our \u003cem\u003eactual\u003c/em\u003e initializer in \u003ccode\u003eaddon/\u003c/code\u003e folder and here we just pass environment configuration.\u003c/p\u003e\n\u003cp\u003eDone.\u003c/p\u003e\n\u003cp\u003eIf you have any comments and/or found some lame mistakes here, please let me know in the comments section below.\u003c/p\u003e\n\u003ch2 id=\"links\"\u003eLinks\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/kuzzmi/ember-cli-webfontloader\"\u003eember-cli-webfontloader - GitHub\u003c/a\u003e (here you can find sources of the plugin)\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/typekit/webfontloader\"\u003eWebFontLoader - GitHub\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e","type":"blog","meta":{"slug":"creating-ember-cli-addon-with-external-library-part-2","title":"Creating Ember CLI Addon with External Library. Part 2","layout":"post","lang":"en","description":"In this post we will finish development of ember-cli-webfontloader addon and I will describe some issues you might experience during addon development, so you can gain some experience of solving those by reading.\n","tags":["technology","ember","javascript","tutorial"],"date":"2016-02-20 13:58:16 +0200"}},"_nextI18Next":{"initialI18nStore":{"en":{"common":{"common":{"name":"Igor Kuzmenko","version":"version","articleFooter":"If you enjoyed the reading, you can tip me \u003ca href=\"https://fundof.me/kuzzmi?tip\" target=\"_blank\" rel=\"noreferrer\"\u003ehere\u003c/a\u003e 😉","articleNotAvailable":"This content is available only in Ukrainian."},"menu":{"home":"Home","blog":"Tech articles","thoughts":"Thoughts","podcast":"Podcast","projects":"Projects","about":"About me"},"home":{"meta":{"description":"Home page of Igor Kuzmenko"},"bio":"developer and tech entrepreneur","read":"Read","recents":"Recent publications","description":{"part_1":"Here I publish ","part_2":"my thoughts","part_3":" and ","part_4":" tech articles","part_5":". Avid Linux and vim user. Co-founder at "}},"blog":{"description":"Different findings in the tech world that I want to share with world."},"thoughts":{"description":"My thoughts about life and work in Ukrainian."}}}},"initialLocale":"en","userConfig":{"i18n":{"defaultLocale":"en","locales":["en","ua"]},"default":{"i18n":{"defaultLocale":"en","locales":["en","ua"]}}}}},"__N_SSG":true},"page":"/[locale]/blog/[slug]","query":{"locale":"en","slug":"creating-ember-cli-addon-with-external-library-part-2"},"buildId":"s_On4rM-yupbqrR83MUiz","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>